var words=get_words();
var translation="";


function record_vote(syn_id){
	$.post("/games/record_vote", {synonym_id: syn_id } );
}

function display_next_word(){
	$('.vote_form').remove();
	if(check_empty_words()){
		return;
	}
	$('.zone').append('<div class=\"vote_form\"></div>');
	var word = words.shift();
    $.post("/games/vote", { word: word});
}

function skip_keyword(){
	$('.alert').remove();
	display_next_word();
} 

function update_errors(record_output){
	$('.alert').remove();
	$('#box_buttons').append('<div class="alert"></div>');
	if(record_output == 1) {
		<% if I18n.locale ==:en %>
			$('.alert').append('<p style="font-size:20px; ">you cannot insert a blank synonym</p>');
		<% else %>
			$('.alert').append('<p style="font-size:20px; ">يجب ان تكتب معني.</p>');
		<% end %>
	} 
	if(record_output == 2){
		<% if I18n.locale == :en %>
			$('.alert').append('<p style="font-size:20px; ">the synonym already exists for this word</p>');
		<% else %>
			$('.alert').append('<p style="font-size:20px; ">المعني موجود بالفعل.</p>');
		<% end %>
	}
	if( record_output == 3){
		<% if I18n.locale == :en %>
			$('.alert').append('<p style="font-size:20px; ">The synonym should be in arabic</p>');
		<% else %>
			$('.alert').append('<p style="font-size:20px; ">يجب ان يكون المعني باللغة العربية</p>');
		<% end %>
	}
}

function modalToggle(){
  $("#report_modal").modal("toggle");
}
function setChecked(chkbox){
  $chkbox = $(chkbox)
  if($chkbox.attr("is_checked") == "true")
    $chkbox.attr("is_checked", false);
  else
    $chkbox.attr("is_checked", true);
}
function report_submission(){
  $reported_keywords = $("#report_modal").find("[is_checked=true]");
  if($reported_keywords.length == 0)
    return;
  words = new Array();
  $.each($reported_keywords, function(index, element){
    words.push($(element).attr("value"));
  });
  var request = $.post("<%= send_report_path %>", { reported_words: words });
  $.each($("input#chkbox"), function(index, element){
    $(element).attr("checked", false);
    $(element).attr("is_checked", false);
  });

  request.done(function (_, _, _){
    restoreError();
    showFlash();
  });

  request.fail(function (_, _, _){
    showError();
  });
}

function showFlash(){
  $("#report_success").css("display", "block");
  $("#report_success").css("margin-bottom", "2px");
  $("#report_success").css("padding-top", "6px");
  $("#report_success").css("padding-bottom", "6px");
  $("#report_success").css("padding-right", "12px");
  $("#report_success").css("padding-left", "12px");
  $("#report_success").css("position", "fixed");
  $("#report_success").css("top", "50px");
  $("#report_success").css("left", "42%");
  $("#report_success").css("right", "42%");
  $("#report_success").fadeOut(5000);
}

function showError(){
  $("#report_failure").css("display", "block");
  $("#report_failure").css("margin-bottom", "2px");
  $("#report_failure").css("position", "fixed");
  $("#report_failure").css("top", "50px");
  $("#report_failure").css("left", "10%");
  $("#report_failure").css("right", "10%");
}

function restoreError(){
  $("#report_failure").css("display", "none");
}


function suggest_synonym_to_word(keyword_id){
	translation = document.getElementById('<% if I18n.locale == :en %>' + 
		'suggest_synonym_textbox<% else %>' + 
		'suggest_synonym_textbox_arabic<% end %>').value;
	$.post("/games/record_synonym" ,{synonym_name: translation, 
		keyword_id: keyword_id});
}

vote_form=[];
vote_form.push('<div style="position:relative; left: 10px;" >');
vote_form.push('<% submitted_word = @word %>');
vote_form.push('<% keyword = @keyword%>');
vote_form.push('<% syn_list = @synonym_list %>');
vote_form.push('<% if syn_list.size > 0 %>');
vote_form.push('<% if I18n.locale == :ar %>');
vote_form.push('<p id="text" class="text_arabic" > من فضلك اختر معني لكلمة:</p></br><p style="font-weight:bold; text-align:center;" >"<%= submitted_word %>"</p>');
vote_form.push('<% end %>');
vote_form.push('<% if I18n.locale == :en %>');
vote_form.push('<p id="text" class="text_english" > please choose a synonym for the word:</p></br><p style="font-weight:bold; text-align:center;" >"<%= submitted_word %>"</p>');
vote_form.push('<% end %>');
vote_form.push('<% end %>');
vote_form.push('<% if syn_list.size == 0 %>');
vote_form.push('<% if I18n.locale == :ar %>');
vote_form.push('<p id="text" class="text_arabic" > من فضلك ادخل معني مناسب لكلمة:</p></br><p style="font-weight:bold; text-align:center;">"<%= submitted_word %>"</p>');
vote_form.push('<% else %>');
vote_form.push('<p id="text" class="text_english" > please enter a synonym for the word:</p></br><p style="font-weight:bold; text-align:center;" >"<%= submitted_word %>"</p>');
vote_form.push('<% end %>');
vote_form.push('<% end %>');
vote_form.push('<div class="btn-toolbar" id="synonym_buttons">');
vote_form.push('<% i=1 %>');
vote_form.push('<%syn_list.each do |syn|%>');
vote_form.push('<% if i%2==1 %><div class="btn-group" id="synonym_buttons_row"><% end%>');
vote_form.push('<% if syn.approved %>');
vote_form.push('<button class="btn btn-success" id="synonym_button" type="submit" onclick="record_vote(<%= syn.id %>)"><%= syn.name %></button>');
vote_form.push('<% end %>');
vote_form.push('<% if syn.approved %>');
vote_form.push('<% if i%2==0 %></div></br><% end %>');
vote_form.push('<% i=i+1 %>');
vote_form.push('<% end %>');
vote_form.push('<% end %>');
vote_form.push('<% if I18n.locale == :ar %>');
vote_form.push('</br><div id="box_buttons">');
vote_form.push('</br><input type="text" id="suggest_synonym_textbox_arabic" placeholder="ادخل معني" >');
vote_form.push('<button class="btn btn-primary" type="submit" id="suggest_synonym_button_arabic"  onclick="suggest_synonym_to_word(<% if keyword %><%= keyword.id %><% end %>);" >سجل هذا المعني</button>');
vote_form.push('</div>');
vote_form.push('<% else %>');
vote_form.push('</br><div id="box_buttons">');
vote_form.push('</br><input type="text" id="suggest_synonym_textbox" placeholder="enter a synonym" >');
vote_form.push('<button class="btn btn-primary" type="submit" id="suggest_synonym_button_english"  onclick="suggest_synonym_to_word(<% if keyword %><%= keyword.id %><% end %>);" >save new synonym</button>');
vote_form.push('</div>');
vote_form.push('<% end %>');
vote_form.push('</div></br>');
vote_form.push('<div style="float:left;" id="skip_button">');
vote_form.push('<% if I18n.locale == :ar %>');
vote_form.push('<button class="btn btn-primary" id="skip_button" type="submit" onclick="skip_keyword()" style="margin-right: 500px;">  تخطي هذه الكلمة >></button>');
vote_form.push('<% else %>');
vote_form.push('<button class="btn btn-primary" id="skip_button" type="submit" onclick="skip_keyword()" style="margin-left: 430px;">  skip this word>></button>');
vote_form.push('<% end %>');
vote_form.push('<a href="#report_modal" role="button" class="btn btn-primary" onClick="modalToggle()"
				style="margin-left: 430px;" id="launch_report"><%= t(:report) %></a>');
vote_form.push('</div>');
vote_form.push('</div>');


vote_form=vote_form.join('');

$('.vote_form').append(vote_form);